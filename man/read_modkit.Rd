% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/read_modkit_v2.R
\name{read_modkit}
\alias{read_modkit}
\title{Process and aggregate ModKit bedMethyl files}
\usage{
read_modkit(
  files,
  chrom_sizes,
  target_mod = "m",
  interval_size = 10000000L,
  min_coverage = 1L,
  quality_filter = 0.1,
  combine_strands = FALSE,
  ref_fasta = NULL,
  chromosomes = NULL,
  regions = NULL,
  h5 = FALSE,
  h5_dir = NULL,
  h5temp = NULL,
  coldata = NULL,
  verbose = TRUE
)
}
\arguments{
\item{files}{Character vector of ModKit bedMethyl file paths (.bed.gz with .tbi)}

\item{chrom_sizes}{Path to chromosome sizes file (TSV: chrom<TAB>length). Can be .fai file. REQUIRED.}

\item{target_mod}{Target modification code: "m" (5mC), "h" (5hmC), "a" (6mA), etc. Default "m".}

\item{interval_size}{Genomic interval size (bp) per chunk. Default 10000000 (10MB).
**Ignored when 'regions' is specified** - user regions are processed as-is.}

\item{min_coverage}{Minimum coverage required per site. Default 1.}

\item{quality_filter}{Maximum failure rate (0-1) per site. Default 0.1.}

\item{combine_strands}{Combine CpG strands for cytosine modifications? Default FALSE.}

\item{ref_fasta}{Optional reference FASTA file path (with .fai index) for context annotation.
When provided, adds 'ref_base' and 'context' columns to rowData with reference base
and sequence context (CG/CHG/CHH) information.}

\item{chromosomes}{Character vector of chromosome names to process (e.g., c("chr1", "chr2")).
Only these chromosomes will be divided into intervals and processed.
Mutually exclusive with 'regions'. Default NULL (process all chromosomes).}

\item{regions}{Genomic regions to process. Mutually exclusive with 'chromosomes'.
When provided, these regions are processed directly without dividing into intervals.
Can be:
- **BED file path** (character): Tab-delimited file with chr, start, end (0-based, half-open)
- **data.frame**: Must have columns chr, start, end (0-based, half-open)
Regions on chromosomes not present in input files will be skipped with a warning.
Default NULL (process all chromosomes).}

\item{h5}{Store matrices as HDF5Arrays? Default FALSE.}

\item{h5_dir}{Directory for HDF5 storage. Default NULL.}

\item{h5temp}{Temporary directory for HDF5 files during processing. Default NULL (uses tempdir()).}

\item{coldata}{Optional DataFrame with sample metadata. If NULL, created from filenames.}

\item{verbose}{Print progress messages? Default TRUE.}
}
\value{
A methrix object containing the merged methylation data
}
\description{
Hash-based aggregation for tabix indexed bedMethyl files
}
\details{
The function uses interval-based streaming and merging of tabix indexed modkit output files
- Genome divided into fixed-size intervals (default 10MB)
- Each interval processed independently: discover → aggregate → output
}
\examples{
\dontrun{
# Basic 5mC analysis (chromosome sizes file required)
meth <- read_modkit(modkit_files, chrom_sizes = "hg38.chrom.sizes", target_mod = "m")

# With context extraction
meth <- read_modkit(modkit_files, chrom_sizes = "hg38.chrom.sizes",
                       ref_fasta = "hg38.fa", target_mod = "m")

# Large dataset with HDF5 backend (memory efficient)
meth <- read_modkit(modkit_files, chrom_sizes = "hg38.chrom.sizes",
                       h5 = TRUE, h5_dir = "./h5_data")

# With custom interval size for memory control
meth <- read_modkit(modkit_files, chrom_sizes = "hg38.chrom.sizes", interval_size = 5000000)

# Process only chr1 and chr2
meth <- read_modkit(modkit_files, chrom_sizes = "hg38.chrom.sizes",
                       chromosomes = c("chr1", "chr2"))

# Process specific genomic regions (BED file)
meth <- read_modkit(modkit_files, chrom_sizes = "hg38.chrom.sizes",
                       regions = "promoters.bed")

# Process custom regions (data.frame)
my_regions <- data.frame(
  chr = c("chr1", "chr1", "chr2"),
  start = c(1000000, 5000000, 2000000),
  end = c(2000000, 6000000, 3000000)
)
meth <- read_modkit(modkit_files, chrom_sizes = "hg38.chrom.sizes",
                       regions = my_regions)
}

}
